const  ThermiaAPI  = require('./ThermiaAPI');
const { ThermiaHeatPump } = require('./ThermiaHeatPump');
const { THERMIA_API_TYPE_CLASSIC } = require('./ThermiaOnlineAPIConst');

class Thermia {
    constructor(username, password, apiType = THERMIA_API_TYPE_CLASSIC) {
        this._username = username;
        this._password = password;

        this.apiInterface = new ThermiaAPI(username, password, apiType);
        this.connected = this.apiInterface.authenticated;

        this.heatPumps = this.fetchHeatPumps();
    }

    async fetchHeatPumps() {
        const devices = await this.apiInterface.getDevices();
        const heatPumps = [];

       // for (const device of devices) {
            heatPumps.push(new ThermiaHeatPump(devices, this.apiInterface));
      //  }

        return heatPumps;
    }

    updateData() {
        for (const heatPump of this.heatPumps) {
            heatPump.updateData();
        }
    }
}

module.exports = Thermia;